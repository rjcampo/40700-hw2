---
title: "MACS 40700 HW 2"
author: "Richard Campo"
date: "`r Sys.Date()`"
output: github_output
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
setwd("C:/Users/RichardCampo/Documents/GitHub/40700-hw2")
options(rstudio.help.showDataPreview = FALSE)
```

#Part 1: Portfolio 1 Proposal

I will use the "Trust and Democratic Governance" data set from the Organization for Economic Cooperation and Development (OECD), available [here](https://data-explorer.oecd.org/vis?lc=en&fs[0]=Topic%2C1%7CGovernment%23GOV%23%7CGeneral%20government%23GOV_GG%23&pg=0&fc=Topic&bp=true&snb=14&vw=ov&df[ds]=dsDisseminateFinalDMZ&df[id]=DSD_GOV_TDG_SPS_GPC%40DF_GOV_TDG_2023&df[ag]=OECD.GOV.GIP&df[vs]=1.0&pd=%2C&dq=A.......&ly[rw]=REF_AREA&ly[cl]=MEASURE%2CSCALE&to[TIME_PERIOD]=false&lo=5&lom=LASTNPERIODS).

My tentative research question is: "Trust in what levels and branches of government has the strongest association with perceived political efficacy, defined as 'having a say in what the government does?'" In this case, the independent variable is the level of trust in government, and the dependent variable is political efficacy. 

## Data Cleaning
```{r, warning=FALSE, message=FALSE}
library(tidyverse)
library(patchwork)

oecd_data <- read_csv("OECD governance data.csv")
```

```{r}
oecd_data <- oecd_data %>%
  filter(REF_AREA != "OECD_REP") %>%
  select(
    country = REF_AREA,
    measure = MEASURE,
    scale = SCALE,
    percentage = OBS_VALUE
    )

oecd_data <- oecd_data %>% 
  pivot_wider(names_from = c(measure, scale), values_from = percentage)
```

## Plot 1: Distribution of Political Efficacy
```{r}
ggplot(oecd_data, aes(x = TRUST_PE_EXT_CON)) +
  geom_histogram(binwidth = 10, fill = "deepskyblue3", color = "white", alpha = 0.7, show.legend = FALSE, na.rm = TRUE) +
  labs(
    title = "Distribution of Perceived Political Efficacy",
    x = "Political Efficacy",
    y = "Frequency"
  ) +
  theme_minimal() +
  theme(
    text = element_text(size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

## Plot 2: Distribution of the Trust Variables
```{r}
trust_columns <- c("TRUST_NG_HMH", "TRUST_LG_HMH", "TRUST_CS_HMH", "TRUST_LE_HMH", "TRUST_CL_HMH", "TRUST_DAT_LIK")

trust_data <- oecd_data[, trust_columns]

trust_data_long <- pivot_longer(trust_data, cols = colnames(trust_data), names_to = "gov_type", values_to = "percentage")

ggplot(trust_data_long, aes(x = gov_type, y = percentage, fill = gov_type)) +
  geom_boxplot(show.legend = FALSE, na.rm = TRUE) +
  labs(
    title = "Distribution of trust levels across government types",
    x = "Government type",
    y = "Percentage reporting high or moderately high trust"
  ) +
  theme_minimal() +
  scale_fill_brewer(palette = "Set3") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## Plot 3: Trust in government vs. political efficacy
```{r}
trust_vars <- c("TRUST_NG_HMH", "TRUST_LG_HMH", "TRUST_CS_HMH", "TRUST_LE_HMH", "TRUST_CL_HMH", "TRUST_DAT_LIK")

trust_labels <- c("Trust in national government", "Trust in local government", "Trust in civil service", "Trust in legislature", "Trust in courts", "Trust government use of data")

plots <- list()

for (i in seq_along(trust_vars)) {
  var <- trust_vars[i]
  label <- trust_labels[i]
  
  # .data[[]] converts the string to the column name
  plot <- ggplot(
    oecd_data, aes(x = .data[[var]], y = TRUST_PE_EXT_CON)) + 
      geom_point(
        color = "deepskyblue3", alpha = 0.5, shape = 19, na.rm = TRUE
        ) + 
      stat_smooth(
        method = "lm",
        formula = y ~ x,
        se = TRUE,
        level = 0.90,
        aes(fill = "Confidence Interval"),
        color = "deepskyblue3",
        size = 1.25,
        alpha = 0.2,
        na.rm = TRUE
      ) + 
      labs(x = label, y = "Political efficacy") + 
      scale_x_continuous(name = label) + 
      # Color standard error shading
      scale_fill_manual(values = "deepskyblue3", guide = FALSE) +
      theme_minimal()
  
  plots[[i]] <- plot
}

combined_plot <- wrap_plots(plots, ncol = 3) +
  plot_annotation(title = "Trust in government vs political efficacy",
                  # Center the title
                  theme = theme(
                    plot.title = element_text(hjust = 0.5)
                    )
                  )

print(combined_plot)
# The extra data frame printing is a known bug in RStudio:
# https://github.com/thomasp85/patchwork/issues/331
```


